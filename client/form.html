<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz - KRMU Green</title>
    <link rel="stylesheet" href="styles.css">

    <!-- Firebase Config handled by firebase-init.js at bottom -->
</head>

<body>
    <div class="video-bg-container">
        <video autoplay loop muted playsinline class="back-video">
            <source src="green-forest-moewalls-com.mp4" type="video/mp4">
        </video>
    </div>
    <div class="video-overlay"></div>

    <div id="toast" class="popup-toast">Correct!</div>

    <nav class="navbar">
        <div class="brand">Sustainable <span class="glow-brand">QUIZ</span></div>
        <div style="display:flex; align-items:center; gap: 20px;">
            <div class="score-badge">Score: <span id="current-score">0</span></div>
            <span id="userRoll" style="color: var(--primary); font-size: 0.8rem;"></span>
            <button id="logoutBtn" class="glow-btn" style="font-size: 0.7rem;">Logout</button>
        </div>
    </nav>

    <div class="main-container">
        <div class="glass-panel"
            style="max-width: 900px; width: 95%; padding: 0; min-height: 600px; overflow: hidden; display: flex; flex-direction: column;">

            <div
                style="padding: 1.5rem 2.5rem; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2);">
                <span style="color: #aaa; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 2px;">KRMU
                    Challenge</span>
                <div>
                    <span id="q-number" style="font-size: 2rem; font-weight: bold; color: var(--primary);">1</span>
                    <span style="color: #666; font-size: 1.2rem;">/ 20</span>
                </div>
            </div>

            <!-- Department Selection Overlay -->
            <div id="dept-selection"
                style="position: absolute; inset: 0; background: rgba(10,10,12,0.95); z-index: 20; display: flex; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(10px);">
                <h2 style="color: white; margin-bottom: 2rem;">Select Your Department</h2>
                <select id="departmentSelect" class="glow-btn"
                    style="width: 300px; text-align: center; margin-bottom: 2rem; background: var(--glass-bg); color: white;">
                    <option value="" disabled selected>Choose Department...</option>
                    <option value="Computer Science">Computer Science (SOET)</option>
                    <option value="Law">Law (SOL)</option>
                    <option value="Management">Management (SOM)</option>
                    <option value="Engineering">Engineering (Mech/Civil/Electronics)</option>
                    <option value="Medical">Medical / Allied Health</option>
                    <option value="Fashion">Fashion & Design</option>
                    <option value="Journalism">Journalism & Mass Comm</option>
                    <option value="Basic Sciences">Basic Sciences</option>
                    <option value="Architecture">Architecture</option>
                    <option value="Education">Education</option>
                    <option value="Other">Other</option>
                </select>
                <button id="startQuizBtn" class="glow-btn" disabled>Start Quiz</button>
            </div>

            <div class="flashcard-container" style="flex: 1;">
                <div class="flashcard-inner" id="card-inner">

                    <div class="flashcard-front">
                        <h3 id="question-text">Loading Question...</h3>

                        <div id="options-container"></div>
                    </div>

                    <div class="flashcard-back">
                        <div
                            style="max-width: 90%; width: 100%; display: flex; flex-direction: column; align-items: center;">
                            <h2
                                style="color: var(--primary); margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 2px; font-size: 1.2rem;">
                                Insight</h2>

                            <div
                                style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); width: 100%; text-align: left;">
                                <h3 id="correct-answer-display"
                                    style="color: var(--primary); margin-bottom: 1rem; font-size: 1.1rem; line-height: 1.4;">
                                </h3>
                                <hr
                                    style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin-bottom: 1rem;">
                                <p id="explanation-text" style="color: #eee; line-height: 1.6; font-size: 1rem;">
                                    Explanation text goes here...</p>
                            </div>

                            <button id="flipBackBtn" class="glow-btn" style="margin-top: 2rem;">Back to Quiz</button>
                        </div>
                    </div>

                </div>
            </div>

            <div
                style="padding: 1.5rem 2.5rem; border-top: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2);">
                <button id="skipBtn" class="glow-btn"
                    style="border-color: #666; color: #888; background: transparent;">Skip Question</button>
                <div style="display: flex; gap: 15px;">
                    <button id="flipBtn" class="glow-btn"
                        style="background: rgba(255,255,255,0.1); border-color: white; color: white; display: none;">View
                        Explanation ↻</button>
                    <button id="nextBtn" class="glow-btn" style="display: none;">Next →</button>
                </div>
            </div>

        </div>
    </div>

    <!-- Firebase Auth SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="js/env-config.js"></script>
    <script src="js/firebase-init.js"></script>
    <script src="script.js"></script>
    <script>
        // Check authentication via Firebase
        let currentUser = null;

        // Wait for Firebase to be ready
        function checkAuth() {
            if (!firebase || !firebase.auth) {
                setTimeout(checkAuth, 100);
                return;
            }

            firebase.auth().onAuthStateChanged((user) => {
                if (!user) {
                    window.location.href = 'index.html';
                    return;
                }

                currentUser = {
                    email: user.email,
                    rollNumber: user.email.split('@')[0]
                };

                document.getElementById('userRoll').textContent = currentUser.rollNumber;

                // Trigger quiz initialization after auth check
                if (window.initQuiz) window.initQuiz(currentUser.rollNumber);
            });
        }

        checkAuth();

        document.getElementById('logoutBtn').addEventListener('click', () => {
            firebase.auth().signOut().then(() => {
                window.location.href = 'index.html';
            });
        });
    </script>
</body>

</html>